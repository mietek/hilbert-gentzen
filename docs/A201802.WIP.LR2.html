<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>A201802.WIP.LR2</title><link rel="stylesheet" href="AgdaPP.css"></head><body><pre class="Agda"><a id="1" class="Keyword">module</a> <a id="8" href="A201802.WIP.LR2.html" class="Module">A201802.WIP.LR2</a> <a id="24" class="Keyword">where</a>

<a id="31" class="Keyword">open</a> <a id="36" class="Keyword">import</a> <a id="43" href="A201801.Prelude.html" class="Module">A201801.Prelude</a>
<a id="59" class="Keyword">open</a> <a id="64" class="Keyword">import</a> <a id="71" href="A201801.Category.html" class="Module">A201801.Category</a>
<a id="88" class="Keyword">open</a> <a id="93" class="Keyword">import</a> <a id="100" href="A201801.Fin.html" class="Module">A201801.Fin</a>
<a id="112" class="Keyword">open</a> <a id="117" class="Keyword">import</a> <a id="124" href="A201801.FinLemmas.html" class="Module">A201801.FinLemmas</a>
<a id="142" class="Keyword">open</a> <a id="147" class="Keyword">import</a> <a id="154" href="A201801.Vec.html" class="Module">A201801.Vec</a>
<a id="166" class="Keyword">open</a> <a id="171" class="Keyword">import</a> <a id="178" href="A201801.VecLemmas.html" class="Module">A201801.VecLemmas</a>
<a id="196" class="Keyword">open</a> <a id="201" class="Keyword">import</a> <a id="208" href="A201801.AllVec.html" class="Module">A201801.AllVec</a>

<a id="224" class="Keyword">open</a> <a id="229" class="Keyword">import</a> <a id="236" href="A201802.LR0.html" class="Module">A201802.LR0</a>
<a id="248" class="Keyword">open</a> <a id="253" class="Keyword">import</a> <a id="260" href="A201802.LR0Lemmas.html" class="Module">A201802.LR0Lemmas</a>
<a id="278" class="Keyword">open</a> <a id="283" class="Keyword">import</a> <a id="290" href="A201802.LR1.html" class="Module">A201802.LR1</a>


<a id="304" class="Comment">--------------------------------------------------------------------------------</a>


<a id="387" class="Comment">-- `Val M` says that the term `M` is a value.</a>
<a id="433" class="Keyword">data</a> <a id="Val"></a><a id="438" href="A201802.WIP.LR2.html#438" class="Datatype">Val</a> <a id="442" class="Symbol">{</a><a id="443" href="A201802.WIP.LR2.html#443" class="Bound">g</a><a id="444" class="Symbol">}</a> <a id="446" class="Symbol">:</a> <a id="448" href="A201802.LR0.html#547" class="Datatype">Term</a> <a id="453" href="A201802.WIP.LR2.html#443" class="Bound">g</a> <a id="455" class="Symbol">→</a> <a id="457" class="PrimitiveType">Set</a>
  <a id="463" class="Keyword">where</a>
    <a id="473" class="Keyword">instance</a>
      <a id="Val.val-lam"></a><a id="488" href="A201802.WIP.LR2.html#488" class="InductiveConstructor">val-lam</a>   <a id="498" class="Symbol">:</a> <a id="500" class="Symbol">∀</a> <a id="502" class="Symbol">{</a><a id="503" href="A201802.WIP.LR2.html#503" class="Bound">M</a><a id="504" class="Symbol">}</a> <a id="506" class="Symbol">→</a> <a id="508" href="A201802.WIP.LR2.html#438" class="Datatype">Val</a> <a id="512" class="Symbol">(</a><a id="513" href="A201802.LR0.html#607" class="InductiveConstructor">LAM</a> <a id="517" href="A201802.WIP.LR2.html#503" class="Bound">M</a><a id="518" class="Symbol">)</a>
      <a id="Val.val-pair"></a><a id="526" href="A201802.WIP.LR2.html#526" class="InductiveConstructor">val-pair</a>  <a id="536" class="Symbol">:</a> <a id="538" class="Symbol">∀</a> <a id="540" class="Symbol">{</a><a id="541" href="A201802.WIP.LR2.html#541" class="Bound">M</a> <a id="543" href="A201802.WIP.LR2.html#543" class="Bound">N</a><a id="544" class="Symbol">}</a> <a id="546" class="Symbol">→</a> <a id="548" class="Symbol">{{</a><a id="550" href="A201802.WIP.LR2.html#550" class="Bound">_</a> <a id="552" class="Symbol">:</a> <a id="554" href="A201802.WIP.LR2.html#438" class="Datatype">Val</a> <a id="558" href="A201802.WIP.LR2.html#541" class="Bound">M</a><a id="559" class="Symbol">}}</a> <a id="562" class="Symbol">{{</a><a id="564" href="A201802.WIP.LR2.html#564" class="Bound">_</a> <a id="566" class="Symbol">:</a> <a id="568" href="A201802.WIP.LR2.html#438" class="Datatype">Val</a> <a id="572" href="A201802.WIP.LR2.html#543" class="Bound">N</a><a id="573" class="Symbol">}}</a> <a id="576" class="Symbol">→</a> <a id="578" href="A201802.WIP.LR2.html#438" class="Datatype">Val</a> <a id="582" class="Symbol">(</a><a id="583" href="A201802.LR0.html#678" class="InductiveConstructor">PAIR</a> <a id="588" href="A201802.WIP.LR2.html#541" class="Bound">M</a> <a id="590" href="A201802.WIP.LR2.html#543" class="Bound">N</a><a id="591" class="Symbol">)</a>
      <a id="Val.val-unit"></a><a id="599" href="A201802.WIP.LR2.html#599" class="InductiveConstructor">val-unit</a>  <a id="609" class="Symbol">:</a> <a id="611" href="A201802.WIP.LR2.html#438" class="Datatype">Val</a> <a id="615" href="A201802.LR0.html#771" class="InductiveConstructor">UNIT</a>
      <a id="Val.val-left"></a><a id="626" href="A201802.WIP.LR2.html#626" class="InductiveConstructor">val-left</a>  <a id="636" class="Symbol">:</a> <a id="638" class="Symbol">∀</a> <a id="640" class="Symbol">{</a><a id="641" href="A201802.WIP.LR2.html#641" class="Bound">M</a><a id="642" class="Symbol">}</a> <a id="644" class="Symbol">→</a> <a id="646" class="Symbol">{{</a><a id="648" href="A201802.WIP.LR2.html#648" class="Bound">_</a> <a id="650" class="Symbol">:</a> <a id="652" href="A201802.WIP.LR2.html#438" class="Datatype">Val</a> <a id="656" href="A201802.WIP.LR2.html#641" class="Bound">M</a><a id="657" class="Symbol">}}</a> <a id="660" class="Symbol">→</a> <a id="662" href="A201802.WIP.LR2.html#438" class="Datatype">Val</a> <a id="666" class="Symbol">(</a><a id="667" href="A201802.LR0.html#818" class="InductiveConstructor">LEFT</a> <a id="672" href="A201802.WIP.LR2.html#641" class="Bound">M</a><a id="673" class="Symbol">)</a>
      <a id="Val.val-right"></a><a id="681" href="A201802.WIP.LR2.html#681" class="InductiveConstructor">val-right</a> <a id="691" class="Symbol">:</a> <a id="693" class="Symbol">∀</a> <a id="695" class="Symbol">{</a><a id="696" href="A201802.WIP.LR2.html#696" class="Bound">M</a><a id="697" class="Symbol">}</a> <a id="699" class="Symbol">→</a> <a id="701" class="Symbol">{{</a><a id="703" href="A201802.WIP.LR2.html#703" class="Bound">_</a> <a id="705" class="Symbol">:</a> <a id="707" href="A201802.WIP.LR2.html#438" class="Datatype">Val</a> <a id="711" href="A201802.WIP.LR2.html#696" class="Bound">M</a><a id="712" class="Symbol">}}</a> <a id="715" class="Symbol">→</a> <a id="717" href="A201802.WIP.LR2.html#438" class="Datatype">Val</a> <a id="721" class="Symbol">(</a><a id="722" href="A201802.LR0.html#846" class="InductiveConstructor">RIGHT</a> <a id="728" href="A201802.WIP.LR2.html#696" class="Bound">M</a><a id="729" class="Symbol">)</a>
      <a id="Val.val-true"></a><a id="737" href="A201802.WIP.LR2.html#737" class="InductiveConstructor">val-true</a>  <a id="747" class="Symbol">:</a> <a id="749" href="A201802.WIP.LR2.html#438" class="Datatype">Val</a> <a id="753" href="A201802.LR0.html#932" class="InductiveConstructor">TRUE</a>
      <a id="Val.val-false"></a><a id="764" href="A201802.WIP.LR2.html#764" class="InductiveConstructor">val-false</a> <a id="774" class="Symbol">:</a> <a id="776" href="A201802.WIP.LR2.html#438" class="Datatype">Val</a> <a id="780" href="A201802.LR0.html#951" class="InductiveConstructor">FALSE</a>


<a id="788" class="Comment">-- `Vals τ` says that all terms `τ` are values.</a>
<a id="836" class="Keyword">data</a> <a id="Vals"></a><a id="841" href="A201802.WIP.LR2.html#841" class="Datatype">Vals</a> <a id="846" class="Symbol">{</a><a id="847" href="A201802.WIP.LR2.html#847" class="Bound">g</a><a id="848" class="Symbol">}</a> <a id="850" class="Symbol">:</a> <a id="852" class="Symbol">∀</a> <a id="854" class="Symbol">{</a><a id="855" href="A201802.WIP.LR2.html#855" class="Bound">n</a><a id="856" class="Symbol">}</a> <a id="858" class="Symbol">→</a> <a id="860" href="A201802.LR0.html#1014" class="Function">Terms</a> <a id="866" href="A201802.WIP.LR2.html#847" class="Bound">g</a> <a id="868" href="A201802.WIP.LR2.html#855" class="Bound">n</a> <a id="870" class="Symbol">→</a> <a id="872" class="PrimitiveType">Set</a>
  <a id="878" class="Keyword">where</a>
    <a id="888" class="Keyword">instance</a>
      <a id="Vals.∙"></a><a id="903" href="A201802.WIP.LR2.html#903" class="InductiveConstructor">∙</a>   <a id="907" class="Symbol">:</a> <a id="909" href="A201802.WIP.LR2.html#841" class="Datatype">Vals</a> <a id="914" href="A201801.Vec.html#266" class="InductiveConstructor">∙</a>
      <a id="Vals._,_"></a><a id="922" href="A201802.WIP.LR2.html#922" class="InductiveConstructor Operator">_,_</a> <a id="926" class="Symbol">:</a> <a id="928" class="Symbol">∀</a> <a id="930" class="Symbol">{</a><a id="931" href="A201802.WIP.LR2.html#931" class="Bound">n</a> <a id="933" href="A201802.WIP.LR2.html#933" class="Bound">M</a><a id="934" class="Symbol">}</a> <a id="936" class="Symbol">→</a> <a id="938" class="Symbol">{</a><a id="939" href="A201802.WIP.LR2.html#939" class="Bound">τ</a> <a id="941" class="Symbol">:</a> <a id="943" href="A201802.LR0.html#1014" class="Function">Terms</a> <a id="949" href="A201802.WIP.LR2.html#847" class="Bound">g</a> <a id="951" href="A201802.WIP.LR2.html#931" class="Bound">n</a><a id="952" class="Symbol">}</a> <a id="954" class="Symbol">→</a> <a id="956" href="A201802.WIP.LR2.html#841" class="Datatype">Vals</a> <a id="961" href="A201802.WIP.LR2.html#939" class="Bound">τ</a> <a id="963" class="Symbol">→</a> <a id="965" href="A201802.WIP.LR2.html#438" class="Datatype">Val</a> <a id="969" href="A201802.WIP.LR2.html#933" class="Bound">M</a> <a id="971" class="Symbol">→</a> <a id="973" href="A201802.WIP.LR2.html#841" class="Datatype">Vals</a> <a id="978" class="Symbol">(</a><a id="979" href="A201802.WIP.LR2.html#939" class="Bound">τ</a> <a id="981" href="A201801.Vec.html#287" class="InductiveConstructor Operator">,</a> <a id="983" href="A201802.WIP.LR2.html#933" class="Bound">M</a><a id="984" class="Symbol">)</a>



<a id="hm"></a><a id="989" href="A201802.WIP.LR2.html#989" class="Function">hm</a> <a id="992" class="Symbol">:</a> <a id="994" class="Symbol">(</a><a id="995" href="A201802.WIP.LR2.html#995" class="Bound">M</a> <a id="997" class="Symbol">:</a> <a id="999" href="A201802.LR0.html#547" class="Datatype">Term</a> <a id="1004" class="Number">0</a><a id="1005" class="Symbol">)</a> <a id="1007" class="Symbol">(</a><a id="1008" href="A201802.WIP.LR2.html#1008" class="Bound">VM</a> <a id="1011" class="Symbol">:</a> <a id="1013" href="A201802.WIP.LR2.html#438" class="Datatype">Val</a> <a id="1017" href="A201802.WIP.LR2.html#995" class="Bound">M</a><a id="1018" class="Symbol">)</a> <a id="1020" class="Symbol">→</a> <a id="1022" href="A201801.Prelude.html#1191" class="Function Operator">¬</a> <a id="1024" class="Symbol">(</a><a id="1025" href="A201801.Vec.html#266" class="InductiveConstructor">∙</a> <a id="1027" href="A201802.LR1.html#348" class="Datatype Operator">⊢</a> <a id="1029" href="A201802.WIP.LR2.html#995" class="Bound">M</a> <a id="1031" href="A201802.LR1.html#348" class="Datatype Operator">⦂</a> <a id="1033" href="A201802.LR0.html#332" class="InductiveConstructor">𝟘</a><a id="1034" class="Symbol">)</a>
<a id="1036" href="A201802.WIP.LR2.html#989" class="Function">hm</a> <a id="1039" class="Symbol">(</a><a id="1040" href="A201802.LR0.html#580" class="InductiveConstructor">VAR</a> <a id="1044" href="A201802.WIP.LR2.html#1044" class="Bound">I</a><a id="1045" class="Symbol">)</a> <a id="1047" class="Symbol">()</a>
<a id="1050" href="A201802.WIP.LR2.html#989" class="Function">hm</a> <a id="1053" class="Symbol">(</a><a id="1054" href="A201802.LR0.html#607" class="InductiveConstructor">LAM</a> <a id="1058" href="A201802.WIP.LR2.html#1058" class="Bound">M</a><a id="1059" class="Symbol">)</a> <a id="1061" href="A201802.WIP.LR2.html#488" class="InductiveConstructor">val-lam</a> <a id="1069" class="Symbol">=</a> <a id="1071" class="Symbol">λ</a> <a id="1073" class="Symbol">()</a>
<a id="1076" href="A201802.WIP.LR2.html#989" class="Function">hm</a> <a id="1079" class="Symbol">(</a><a id="1080" href="A201802.LR0.html#641" class="InductiveConstructor">APP</a> <a id="1084" href="A201802.WIP.LR2.html#1084" class="Bound">M</a> <a id="1086" href="A201802.WIP.LR2.html#1086" class="Bound">N</a><a id="1087" class="Symbol">)</a> <a id="1089" class="Symbol">()</a>
<a id="1092" href="A201802.WIP.LR2.html#989" class="Function">hm</a> <a id="1095" class="Symbol">(</a><a id="1096" href="A201802.LR0.html#678" class="InductiveConstructor">PAIR</a> <a id="1101" href="A201802.WIP.LR2.html#1101" class="Bound">M</a> <a id="1103" href="A201802.WIP.LR2.html#1103" class="Bound">N</a><a id="1104" class="Symbol">)</a> <a id="1106" class="Symbol">(</a><a id="1107" href="A201802.WIP.LR2.html#526" class="InductiveConstructor">val-pair</a><a id="1115" class="Symbol">)</a> <a id="1117" class="Symbol">=</a> <a id="1119" class="Symbol">λ</a> <a id="1121" class="Symbol">()</a>
<a id="1124" href="A201802.WIP.LR2.html#989" class="Function">hm</a> <a id="1127" class="Symbol">(</a><a id="1128" href="A201802.LR0.html#715" class="InductiveConstructor">FST</a> <a id="1132" href="A201802.WIP.LR2.html#1132" class="Bound">M</a><a id="1133" class="Symbol">)</a> <a id="1135" class="Symbol">()</a>
<a id="1138" href="A201802.WIP.LR2.html#989" class="Function">hm</a> <a id="1141" class="Symbol">(</a><a id="1142" href="A201802.LR0.html#743" class="InductiveConstructor">SND</a> <a id="1146" href="A201802.WIP.LR2.html#1146" class="Bound">M</a><a id="1147" class="Symbol">)</a> <a id="1149" class="Symbol">()</a>
<a id="1152" href="A201802.WIP.LR2.html#989" class="Function">hm</a> <a id="1155" href="A201802.LR0.html#771" class="InductiveConstructor">UNIT</a> <a id="1160" href="A201802.WIP.LR2.html#599" class="InductiveConstructor">val-unit</a> <a id="1169" class="Symbol">=</a> <a id="1171" class="Symbol">λ</a> <a id="1173" class="Symbol">()</a>
<a id="1176" href="A201802.WIP.LR2.html#989" class="Function">hm</a> <a id="1179" class="Symbol">(</a><a id="1180" href="A201802.LR0.html#790" class="InductiveConstructor">ABORT</a> <a id="1186" href="A201802.WIP.LR2.html#1186" class="Bound">M</a><a id="1187" class="Symbol">)</a> <a id="1189" class="Symbol">()</a>
<a id="1192" href="A201802.WIP.LR2.html#989" class="Function">hm</a> <a id="1195" class="Symbol">(</a><a id="1196" href="A201802.LR0.html#818" class="InductiveConstructor">LEFT</a> <a id="1201" href="A201802.WIP.LR2.html#1201" class="Bound">M</a><a id="1202" class="Symbol">)</a> <a id="1204" class="Symbol">(</a><a id="1205" href="A201802.WIP.LR2.html#626" class="InductiveConstructor">val-left</a> <a id="1214" class="Symbol">{{</a><a id="1216" href="A201802.WIP.LR2.html#1216" class="Bound">VM</a><a id="1218" class="Symbol">}})</a> <a id="1222" class="Symbol">=</a> <a id="1224" class="Symbol">λ</a> <a id="1226" class="Symbol">()</a>
<a id="1229" href="A201802.WIP.LR2.html#989" class="Function">hm</a> <a id="1232" class="Symbol">(</a><a id="1233" href="A201802.LR0.html#846" class="InductiveConstructor">RIGHT</a> <a id="1239" href="A201802.WIP.LR2.html#1239" class="Bound">M</a><a id="1240" class="Symbol">)</a> <a id="1242" class="Symbol">(</a><a id="1243" href="A201802.WIP.LR2.html#681" class="InductiveConstructor">val-right</a> <a id="1253" class="Symbol">{{</a><a id="1255" href="A201802.WIP.LR2.html#1255" class="Bound">VN</a><a id="1257" class="Symbol">}})</a> <a id="1261" class="Symbol">=</a> <a id="1263" class="Symbol">λ</a> <a id="1265" class="Symbol">()</a>
<a id="1268" href="A201802.WIP.LR2.html#989" class="Function">hm</a> <a id="1271" class="Symbol">(</a><a id="1272" href="A201802.LR0.html#874" class="InductiveConstructor">CASE</a> <a id="1277" href="A201802.WIP.LR2.html#1277" class="Bound">M</a> <a id="1279" href="A201802.WIP.LR2.html#1279" class="Bound">N</a> <a id="1281" href="A201802.WIP.LR2.html#1281" class="Bound">O</a><a id="1282" class="Symbol">)</a> <a id="1284" class="Symbol">()</a>
<a id="1287" href="A201802.WIP.LR2.html#989" class="Function">hm</a> <a id="1290" href="A201802.LR0.html#932" class="InductiveConstructor">TRUE</a> <a id="1295" href="A201802.WIP.LR2.html#737" class="InductiveConstructor">val-true</a> <a id="1304" class="Symbol">=</a> <a id="1306" class="Symbol">λ</a> <a id="1308" class="Symbol">()</a>
<a id="1311" href="A201802.WIP.LR2.html#989" class="Function">hm</a> <a id="1314" href="A201802.LR0.html#951" class="InductiveConstructor">FALSE</a> <a id="1320" href="A201802.WIP.LR2.html#764" class="InductiveConstructor">val-false</a> <a id="1330" class="Symbol">=</a> <a id="1332" class="Symbol">λ</a> <a id="1334" class="Symbol">()</a>
<a id="1337" href="A201802.WIP.LR2.html#989" class="Function">hm</a> <a id="1340" class="Symbol">(</a><a id="1341" href="A201802.LR0.html#970" class="InductiveConstructor">IF</a> <a id="1344" href="A201802.WIP.LR2.html#1344" class="Bound">M</a> <a id="1346" href="A201802.WIP.LR2.html#1346" class="Bound">N</a> <a id="1348" href="A201802.WIP.LR2.html#1348" class="Bound">O</a><a id="1349" class="Symbol">)</a> <a id="1351" class="Symbol">()</a>


<a id="1356" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="1442" class="Comment">-- -- `_⤠_` is the CBV computation relation.</a>
<a id="1487" class="Comment">-- infix 3 _⤠_</a>
<a id="1502" class="Comment">-- data _⤠_ {g} : Term g → Term g → Set</a>
<a id="1542" class="Comment">--   where</a>
<a id="1553" class="Comment">--     app-lam    : ∀ {M N} → {{_ : Val N}} → APP (LAM M) N ⤠ CUT N M</a>
<a id="1623" class="Comment">--     fst-pair   : ∀ {M N} → {{_ : Val M}} {{_ : Val N}} → FST (PAIR M N) ⤠ M</a>
<a id="1702" class="Comment">--     snd-pair   : ∀ {M N} → {{_ : Val M}} {{_ : Val N}} → SND (PAIR M N) ⤠ N</a>
<a id="1781" class="Comment">--     case-left  : ∀ {M N O} → {{_ : Val M}} → CASE (LEFT M) N O ⤠ CUT M N</a>
<a id="1857" class="Comment">--     case-right : ∀ {M N O} → {{_ : Val M}} → CASE (RIGHT M) N O ⤠ CUT M O</a>
<a id="1934" class="Comment">--     if-true    : ∀ {N O} → IF TRUE N O ⤠ N</a>
<a id="1980" class="Comment">--     if-false   : ∀ {N O} → IF FALSE N O ⤠ O</a>


<a id="2029" class="Comment">-- -- Values do not compute.</a>
<a id="2058" class="Comment">-- ¬val⤠ : ∀ {g} → {M M′ : Term g} → {{_ : Val M}}</a>
<a id="2109" class="Comment">--                → ¬ (M ⤠ M′)</a>
<a id="2140" class="Comment">-- ¬val⤠ {{val-lam}}   ()</a>
<a id="2166" class="Comment">-- ¬val⤠ {{val-pair}}  ()</a>
<a id="2192" class="Comment">-- ¬val⤠ {{val-unit}}  ()</a>
<a id="2218" class="Comment">-- ¬val⤠ {{val-left}}  ()</a>
<a id="2244" class="Comment">-- ¬val⤠ {{val-right}} ()</a>
<a id="2270" class="Comment">-- ¬val⤠ {{val-true}}  ()</a>
<a id="2296" class="Comment">-- ¬val⤠ {{val-false}} ()</a>


<a id="2324" class="Comment">-- -- Computation is deterministic.</a>
<a id="2360" class="Comment">-- det⤠ : ∀ {g} → {M M′₁ M′₂ : Term g}</a>
<a id="2399" class="Comment">--               → M ⤠ M′₁ → M ⤠ M′₂</a>
<a id="2436" class="Comment">--               → M′₁ ≡ M′₂</a>
<a id="2465" class="Comment">-- det⤠ app-lam    app-lam    = refl</a>
<a id="2502" class="Comment">-- det⤠ fst-pair   fst-pair   = refl</a>
<a id="2539" class="Comment">-- det⤠ snd-pair   snd-pair   = refl</a>
<a id="2576" class="Comment">-- det⤠ case-left  case-left  = refl</a>
<a id="2613" class="Comment">-- det⤠ case-right case-right = refl</a>
<a id="2650" class="Comment">-- det⤠ if-true    if-true    = refl</a>
<a id="2687" class="Comment">-- det⤠ if-false   if-false   = refl</a>


<a id="2726" class="Comment">-- -- Computation is type-preserving.</a>
<a id="2764" class="Comment">-- tp⤠ : ∀ {g M M′ A} → {Γ : Types g}</a>
<a id="2802" class="Comment">--                     → M ⤠ M′ → Γ ⊢ M ⦂ A</a>
<a id="2846" class="Comment">--                     → Γ ⊢ M′ ⦂ A</a>
<a id="2882" class="Comment">-- tp⤠ app-lam    (app (lam 𝒟) ℰ)      = cut ℰ 𝒟</a>
<a id="2931" class="Comment">-- tp⤠ fst-pair   (fst (pair 𝒟 ℰ))     = 𝒟</a>
<a id="2974" class="Comment">-- tp⤠ snd-pair   (snd (pair 𝒟 ℰ))     = ℰ</a>
<a id="3017" class="Comment">-- tp⤠ case-left  (case (left 𝒟) ℰ ℱ)  = cut 𝒟 ℰ</a>
<a id="3066" class="Comment">-- tp⤠ case-right (case (right 𝒟) ℰ ℱ) = cut 𝒟 ℱ</a>
<a id="3115" class="Comment">-- tp⤠ if-true    (if 𝒟 ℰ ℱ)           = ℰ</a>
<a id="3158" class="Comment">-- tp⤠ if-false   (if 𝒟 ℰ ℱ)           = ℱ</a>


<a id="3203" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="3289" class="Comment">-- -- `_↦_` is the CBV small-step reduction relation.</a>
<a id="3343" class="Comment">-- infix 3 _↦_</a>
<a id="3358" class="Comment">-- data _↦_ {g} : Term g → Term g → Set</a>
<a id="3398" class="Comment">--   where</a>
<a id="3409" class="Comment">--     red : ∀ {M M′} → M ⤠ M′</a>
<a id="3440" class="Comment">--                    → M ↦ M′</a>

<a id="3472" class="Comment">--     cong-app₁ : ∀ {M M′ N} → M ↦ M′</a>
<a id="3511" class="Comment">--                            → APP M N ↦ APP M′ N</a>

<a id="3563" class="Comment">--     cong-app₂ : ∀ {M N N′} → {{_ : Val M}}</a>
<a id="3609" class="Comment">--                            → N ↦ N′</a>
<a id="3648" class="Comment">--                            → APP M N ↦ APP M N′</a>

<a id="3700" class="Comment">--     cong-pair₁ : ∀ {M M′ N} → M ↦ M′</a>
<a id="3740" class="Comment">--                             → PAIR M N ↦ PAIR M′ N</a>

<a id="3795" class="Comment">--     cong-pair₂ : ∀ {M N N′} → {{_ : Val M}}</a>
<a id="3842" class="Comment">--                             → N ↦ N′</a>
<a id="3882" class="Comment">--                             → PAIR M N ↦ PAIR M N′</a>

<a id="3937" class="Comment">--     cong-fst : ∀ {M M′} → M ↦ M′</a>
<a id="3973" class="Comment">--                         → FST M ↦ FST M′</a>

<a id="4018" class="Comment">--     cong-snd : ∀ {M M′} → M ↦ M′</a>
<a id="4054" class="Comment">--                         → SND M ↦ SND M′</a>

<a id="4099" class="Comment">--     cong-abort : ∀ {M M′} → M ↦ M′</a>
<a id="4137" class="Comment">--                           → ABORT M ↦ ABORT M′</a>

<a id="4188" class="Comment">--     cong-left : ∀ {M M′} → M ↦ M′</a>
<a id="4225" class="Comment">--                          → LEFT M ↦ LEFT M′</a>

<a id="4273" class="Comment">--     cong-right : ∀ {M M′} → M ↦ M′</a>
<a id="4311" class="Comment">--                           → RIGHT M ↦ RIGHT M′</a>

<a id="4362" class="Comment">--     cong-case : ∀ {M M′ N O} → M ↦ M′</a>
<a id="4403" class="Comment">--                              → CASE M N O ↦ CASE M′ N O</a>

<a id="4463" class="Comment">--     cong-if : ∀ {M M′ N O} → M ↦ M′</a>
<a id="4502" class="Comment">--                            → IF M N O ↦ IF M′ N O</a>


<a id="4557" class="Comment">-- -- Values do not reduce.</a>
<a id="4585" class="Comment">-- ¬val↦ : ∀ {g} → {M M′ : Term g} → {{_ : Val M}}</a>
<a id="4636" class="Comment">--                → ¬ (M ↦ M′)</a>
<a id="4667" class="Comment">-- ¬val↦ {{val-lam}}   (red ())</a>
<a id="4699" class="Comment">-- ¬val↦ {{val-pair}}  (red ())</a>
<a id="4731" class="Comment">-- ¬val↦ {{val-pair}}  (cong-pair₁ M↦M′) = M↦M′ ↯ ¬val↦</a>
<a id="4787" class="Comment">-- ¬val↦ {{val-pair}}  (cong-pair₂ N↦N′) = N↦N′ ↯ ¬val↦</a>
<a id="4843" class="Comment">-- ¬val↦ {{val-unit}}  (red ())</a>
<a id="4875" class="Comment">-- ¬val↦ {{val-left}}  (red ())</a>
<a id="4907" class="Comment">-- ¬val↦ {{val-left}}  (cong-left M↦M′)  = M↦M′ ↯ ¬val↦</a>
<a id="4963" class="Comment">-- ¬val↦ {{val-right}} (red ())</a>
<a id="4995" class="Comment">-- ¬val↦ {{val-right}} (cong-right M↦M′) = M↦M′ ↯ ¬val↦</a>
<a id="5051" class="Comment">-- ¬val↦ {{val-true}}  (red ())</a>
<a id="5083" class="Comment">-- ¬val↦ {{val-false}} (red ())</a>


<a id="5117" class="Comment">-- -- Computation determines small-step reduction.</a>
<a id="5168" class="Comment">-- red-det↦ : ∀ {g} → {M M′₁ M′₂ : Term g}</a>
<a id="5211" class="Comment">--                   → M ⤠ M′₁ → M ↦ M′₂</a>
<a id="5252" class="Comment">--                   → M′₁ ≡ M′₂</a>
<a id="5285" class="Comment">-- red-det↦ M⤠M′₁     (red M⤠M′₂)       = det⤠ M⤠M′₁ M⤠M′₂</a>
<a id="5344" class="Comment">-- red-det↦ app-lam    (cong-app₁ M↦M′₂) = M↦M′₂ ↯ ¬val↦</a>
<a id="5401" class="Comment">-- red-det↦ app-lam    (cong-app₂ M↦M′₂) = M↦M′₂ ↯ ¬val↦</a>
<a id="5458" class="Comment">-- red-det↦ fst-pair   (cong-fst M↦M′₂)  = M↦M′₂ ↯ ¬val↦</a>
<a id="5515" class="Comment">-- red-det↦ snd-pair   (cong-snd M↦M′₂)  = M↦M′₂ ↯ ¬val↦</a>
<a id="5572" class="Comment">-- red-det↦ case-left  (cong-case M↦M′₂) = M↦M′₂ ↯ ¬val↦</a>
<a id="5629" class="Comment">-- red-det↦ case-right (cong-case M↦M′₂) = M↦M′₂ ↯ ¬val↦</a>
<a id="5686" class="Comment">-- red-det↦ if-true    (cong-if M↦M′₂)   = M↦M′₂ ↯ ¬val↦</a>
<a id="5743" class="Comment">-- red-det↦ if-false   (cong-if M↦M′₂)   = M↦M′₂ ↯ ¬val↦</a>
<a id="5800" class="Comment">-- red-det↦ ()         (cong-pair₁ _)</a>
<a id="5838" class="Comment">-- red-det↦ ()         (cong-pair₂ _)</a>
<a id="5876" class="Comment">-- red-det↦ ()         (cong-abort _)</a>
<a id="5914" class="Comment">-- red-det↦ ()         (cong-left _)</a>
<a id="5951" class="Comment">-- red-det↦ ()         (cong-right _)</a>


<a id="5991" class="Comment">-- -- Small-step reduction is deterministic.</a>
<a id="6036" class="Comment">-- det↦ : ∀ {g} → {M M′₁ M′₂ : Term g}</a>
<a id="6075" class="Comment">--               → M ↦ M′₁ → M ↦ M′₂</a>
<a id="6112" class="Comment">--               → M′₁ ≡ M′₂</a>
<a id="6141" class="Comment">-- det↦ (red M⤠M′₁)        M↦M′₂              = red-det↦ M⤠M′₁ M↦M′₂</a>
<a id="6210" class="Comment">-- det↦ (cong-app₁ M↦M′₁)  (cong-app₁ M↦M′₂)  = (\ M′ → APP M′ _) &amp; det↦ M↦M′₁ M↦M′₂</a>
<a id="6295" class="Comment">-- det↦ (cong-app₁ M↦M′₁)  (cong-app₂ _)       = M↦M′₁ ↯ ¬val↦</a>
<a id="6358" class="Comment">-- det↦ (cong-app₂ _)       (cong-app₁ M↦M′₂)  = M↦M′₂ ↯ ¬val↦</a>
<a id="6421" class="Comment">-- det↦ (cong-app₂ N↦N′₁)  (cong-app₂ N↦N′₂)  = (\ N′ → APP _ N′) &amp; det↦ N↦N′₁ N↦N′₂</a>
<a id="6506" class="Comment">-- det↦ (cong-pair₁ M↦M′₁) (cong-pair₁ M↦M′₂) = (\ M′ → PAIR M′ _) &amp; det↦ M↦M′₁ M↦M′₂</a>
<a id="6592" class="Comment">-- det↦ (cong-pair₁ M↦M′₁) (cong-pair₂ _)      = M↦M′₁ ↯ ¬val↦</a>
<a id="6655" class="Comment">-- det↦ (cong-pair₂ _)      (cong-pair₁ M↦M′₂) = M↦M′₂ ↯ ¬val↦</a>
<a id="6718" class="Comment">-- det↦ (cong-pair₂ N↦N′₁) (cong-pair₂ N↦N′₂) = (\ N′ → PAIR _ N′) &amp; det↦ N↦N′₁ N↦N′₂</a>
<a id="6804" class="Comment">-- det↦ (cong-fst M↦M′₁)   (cong-fst M↦M′₂)   = FST &amp; det↦ M↦M′₁ M↦M′₂</a>
<a id="6875" class="Comment">-- det↦ (cong-snd M↦M′₁)   (cong-snd M↦M′₂)   = SND &amp; det↦ M↦M′₁ M↦M′₂</a>
<a id="6946" class="Comment">-- det↦ (cong-abort M↦M′₁) (cong-abort M↦M′₂) = ABORT &amp; det↦ M↦M′₁ M↦M′₂</a>
<a id="7019" class="Comment">-- det↦ (cong-left M↦M′₁)  (cong-left M↦M′₂)  = LEFT &amp; det↦ M↦M′₁ M↦M′₂</a>
<a id="7091" class="Comment">-- det↦ (cong-right M↦M′₁) (cong-right M↦M′₂) = RIGHT &amp; det↦ M↦M′₁ M↦M′₂</a>
<a id="7164" class="Comment">-- det↦ (cong-case M↦M′₁)  (cong-case M↦M′₂)  = (\ M′ → CASE M′ _ _) &amp; det↦ M↦M′₁ M↦M′₂</a>
<a id="7252" class="Comment">-- det↦ (cong-if M↦M′₁)    (cong-if M↦M′₂)    = (\ M′ → IF M′ _ _) &amp; det↦ M↦M′₁ M↦M′₂</a>
<a id="7338" class="Comment">-- det↦ M↦M′₁              (red M⤠M′₂)        = red-det↦ M⤠M′₂ M↦M′₁ ⁻¹</a>


<a id="7412" class="Comment">-- -- Small-step reduction is type-preserving.</a>
<a id="7459" class="Comment">-- tp↦ : ∀ {g M M′ A} → {Γ : Types g}</a>
<a id="7497" class="Comment">--                     → M ↦ M′ → Γ ⊢ M ⦂ A</a>
<a id="7541" class="Comment">--                     → Γ ⊢ M′ ⦂ A</a>
<a id="7577" class="Comment">-- tp↦ (red M⤠M′)        𝒟            = tp⤠ M⤠M′ 𝒟</a>
<a id="7628" class="Comment">-- tp↦ (cong-app₁ M↦M′)  (app 𝒟 ℰ)    = app (tp↦ M↦M′ 𝒟) ℰ</a>
<a id="7687" class="Comment">-- tp↦ (cong-app₂ M↦M′)  (app 𝒟 ℰ)    = app 𝒟 (tp↦ M↦M′ ℰ)</a>
<a id="7746" class="Comment">-- tp↦ (cong-pair₁ M↦M′) (pair 𝒟 ℰ)   = pair (tp↦ M↦M′ 𝒟) ℰ</a>
<a id="7806" class="Comment">-- tp↦ (cong-pair₂ N↦N′) (pair 𝒟 ℰ)   = pair 𝒟 (tp↦ N↦N′ ℰ)</a>
<a id="7866" class="Comment">-- tp↦ (cong-fst M↦M′)   (fst 𝒟)      = fst (tp↦ M↦M′ 𝒟)</a>
<a id="7923" class="Comment">-- tp↦ (cong-snd M↦M′)   (snd 𝒟)      = snd (tp↦ M↦M′ 𝒟)</a>
<a id="7980" class="Comment">-- tp↦ (cong-abort M↦M′) (abort 𝒟)    = abort (tp↦ M↦M′ 𝒟)</a>
<a id="8039" class="Comment">-- tp↦ (cong-left M↦M′)  (left 𝒟)     = left (tp↦ M↦M′ 𝒟)</a>
<a id="8097" class="Comment">-- tp↦ (cong-right M↦M′) (right 𝒟)    = right (tp↦ M↦M′ 𝒟)</a>
<a id="8156" class="Comment">-- tp↦ (cong-case M↦M′)  (case 𝒟 ℰ ℱ) = case (tp↦ M↦M′ 𝒟) ℰ ℱ</a>
<a id="8218" class="Comment">-- tp↦ (cong-if M↦M′)    (if 𝒟 ℰ ℱ)   = if (tp↦ M↦M′ 𝒟) ℰ ℱ</a>


<a id="8280" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="8366" class="Comment">-- -- `_⤅_` is the iterated small-step reduction relation.</a>
<a id="8425" class="Comment">-- infix 3 _⤅_</a>
<a id="8440" class="Comment">-- data _⤅_ {g} : Term g → Term g → Set</a>
<a id="8480" class="Comment">--   where</a>
<a id="8491" class="Comment">--     -- Iterated small-step reduction is reflexive.</a>
<a id="8545" class="Comment">--     done : ∀ {M} → M ⤅ M</a>

<a id="8574" class="Comment">--     -- Small-step reduction IN REVERSE preserves iterated small-step reduction.</a>
<a id="8657" class="Comment">--     step : ∀ {M M′ M″} → M ↦ M′ → M′ ⤅ M″</a>
<a id="8702" class="Comment">--                        → M ⤅ M″</a>


<a id="8739" class="Comment">-- -- Iterated small-step reduction is transitive.</a>
<a id="8790" class="Comment">-- -- Iterated small-step reduction IN REVERSE preserves iterated small-step reduction.</a>
<a id="8878" class="Comment">-- steps : ∀ {g} → {M M′ M″ : Term g}</a>
<a id="8916" class="Comment">--               → M ⤅ M′ → M′ ⤅ M″</a>
<a id="8952" class="Comment">--               → M ⤅ M″</a>
<a id="8978" class="Comment">-- steps done                M⤅M″  = M⤅M″</a>
<a id="9020" class="Comment">-- steps (step M↦M‴ M‴⤅M′) M′⤅M″ = step M↦M‴ (steps M‴⤅M′ M′⤅M″)</a>


<a id="9087" class="Comment">-- -- When reducing down to a value, the initial small step determines the subsequent small steps.</a>
<a id="9186" class="Comment">-- -- Small-step reduction preserves iterated small-step reduction down to a value.</a>
<a id="9270" class="Comment">-- unstep : ∀ {g} → {M M′ M″ : Term g} → {{_ : Val M″}}</a>
<a id="9326" class="Comment">--                → M ↦ M′ → M ⤅ M″</a>
<a id="9362" class="Comment">--                → M′ ⤅ M″</a>
<a id="9390" class="Comment">-- unstep M↦M′₁ (step M↦M′₂ M′₂⤅M″) with det↦ M↦M′₁ M↦M′₂</a>
<a id="9448" class="Comment">-- unstep M↦M′  (step _      M′⤅M″)  | refl = M′⤅M″</a>
<a id="9500" class="Comment">-- unstep M↦M′  done                  = M↦M′ ↯ ¬val↦</a>


<a id="9555" class="Comment">-- -- When reducing down to a value, iterated small-step reduction is deterministic.</a>
<a id="9640" class="Comment">-- det⤅ : ∀ {g} → {M M′₁ M′₂ : Term g} → {{_ : Val M′₁}} {{_ : Val M′₂}}</a>
<a id="9713" class="Comment">--               → M ⤅ M′₁ → M ⤅ M′₂</a>
<a id="9750" class="Comment">--               → M′₁ ≡ M′₂</a>
<a id="9779" class="Comment">-- det⤅ done                   done                = refl</a>
<a id="9837" class="Comment">-- det⤅ done                   (step M↦M″ M″⤅M′) = M↦M″ ↯ ¬val↦</a>
<a id="9901" class="Comment">-- det⤅ (step M↦M″₁ M″₁⤅M′₁) M⤅M′₂              = det⤅ M″₁⤅M′₁ (unstep M↦M″₁ M⤅M′₂)</a>


<a id="9987" class="Comment">-- -- Iterated small-step reduction is type-preserving.</a>
<a id="10043" class="Comment">-- tp⤅ : ∀ {g M M′ A} → {Γ : Types g}</a>
<a id="10081" class="Comment">--                     → M ⤅ M′ → Γ ⊢ M ⦂ A</a>
<a id="10125" class="Comment">--                     → Γ ⊢ M′ ⦂ A</a>
<a id="10161" class="Comment">-- tp⤅ done                𝒟 = 𝒟</a>
<a id="10194" class="Comment">-- tp⤅ (step M↦M″ M″⤅M′) 𝒟 = tp⤅ M″⤅M′ (tp↦ M↦M″ 𝒟)</a>


<a id="10248" class="Comment">-- -- If `M` reduces to `M′`, then `APP M N` reduces to `APP M′ N`.</a>
<a id="10316" class="Comment">-- congs-app₁ : ∀ {g} → {M M′ N : Term g}</a>
<a id="10358" class="Comment">--                    → M ⤅ M′</a>
<a id="10389" class="Comment">--                    → APP M N ⤅ APP M′ N</a>
<a id="10432" class="Comment">-- congs-app₁ done                = done</a>
<a id="10473" class="Comment">-- congs-app₁ (step M↦M″ M″⤅M′) = step (cong-app₁ M↦M″) (congs-app₁ M″⤅M′)</a>


<a id="10550" class="Comment">-- -- If `N` reduces to `N′`, then `APP (LAM M) N` reduces to `APP (LAM M) N′`.</a>
<a id="10630" class="Comment">-- congs-app₂ : ∀ {g} → {M : Term (suc g)} {N N′ : Term g}</a>
<a id="10689" class="Comment">--                    → N ⤅ N′</a>
<a id="10720" class="Comment">--                    → APP (LAM M) N ⤅ APP (LAM M) N′</a>
<a id="10775" class="Comment">-- congs-app₂ done                = done</a>
<a id="10816" class="Comment">-- congs-app₂ (step M↦M″ M″⤅M′) = step (cong-app₂ M↦M″) (congs-app₂ M″⤅M′)</a>


<a id="10893" class="Comment">-- -- If `M` reduces to `M′` and `N` reduces to `N′`, then `PAIR M N` reduces to `PAIR M′ N′`.</a>
<a id="10988" class="Comment">-- congs-pair : ∀ {g} → {M M′ N N′ : Term g} → {{_ : Val M′}} {{_ : Val N′}}</a>
<a id="11065" class="Comment">--                    → M ⤅ M′ → N ⤅ N′</a>
<a id="11105" class="Comment">--                    → PAIR M N ⤅ PAIR M′ N′</a>
<a id="11151" class="Comment">-- congs-pair done                done                = done</a>
<a id="11212" class="Comment">-- congs-pair done                (step N↦N″ N″⤅N′) = step (cong-pair₂ N↦N″) (congs-pair done N″⤅N′)</a>
<a id="11313" class="Comment">-- congs-pair (step M↦M″ M″⤅M′) N⤅N′               = step (cong-pair₁ M↦M″) (congs-pair M″⤅M′ N⤅N′)</a>


<a id="11415" class="Comment">-- -- If `M` reduces to `M′`, then `FST M` reduces to `FST M′`.</a>
<a id="11479" class="Comment">-- congs-fst : ∀ {g} → {M M′ : Term g}</a>
<a id="11518" class="Comment">--                   → M ⤅ M′</a>
<a id="11548" class="Comment">--                   → FST M ⤅ FST M′</a>
<a id="11586" class="Comment">-- congs-fst done                = done</a>
<a id="11626" class="Comment">-- congs-fst (step M↦M″ M″⤅M′) = step (cong-fst M↦M″) (congs-fst M″⤅M′)</a>


<a id="11700" class="Comment">-- -- If `M` reduces to `M′`, then `SND M` reduces to `SND M′`.</a>
<a id="11764" class="Comment">-- congs-snd : ∀ {g} → {M M′ : Term g}</a>
<a id="11803" class="Comment">--                   → M ⤅ M′</a>
<a id="11833" class="Comment">--                   → SND M ⤅ SND M′</a>
<a id="11871" class="Comment">-- congs-snd done                = done</a>
<a id="11911" class="Comment">-- congs-snd (step M↦M″ M″⤅M′) = step (cong-snd M↦M″) (congs-snd M″⤅M′)</a>


<a id="11985" class="Comment">-- -- If `M` reduces to `M′`, then `LEFT M` reduces to `LEFT M′`.</a>
<a id="12051" class="Comment">-- congs-left : ∀ {g} → {M M′ : Term g} → {{_ : Val M′}}</a>
<a id="12108" class="Comment">--                    → M ⤅ M′</a>
<a id="12139" class="Comment">--                    → LEFT M ⤅ LEFT M′</a>
<a id="12180" class="Comment">-- congs-left done                = done</a>
<a id="12221" class="Comment">-- congs-left (step M↦M″ M″⤅M′) = step (cong-left M↦M″) (congs-left M″⤅M′)</a>


<a id="12298" class="Comment">-- -- If `M` reduces to `M′`, then `RIGHT M` reduces to `RIGHT M′`.</a>
<a id="12366" class="Comment">-- congs-right : ∀ {g} → {M M′ : Term g} → {{_ : Val M′}}</a>
<a id="12424" class="Comment">--                     → M ⤅ M′</a>
<a id="12456" class="Comment">--                     → RIGHT M ⤅ RIGHT M′</a>
<a id="12500" class="Comment">-- congs-right done                = done</a>
<a id="12542" class="Comment">-- congs-right (step M↦M″ M″⤅M′) = step (cong-right M↦M″) (congs-right M″⤅M′)</a>


<a id="12622" class="Comment">-- -- If `M` reduces to `M′`, then `CASE M N O` reduces to `CASE M′ N O`.</a>
<a id="12696" class="Comment">-- congs-case : ∀ {g} → {M M′ : Term g} {N O : Term (suc g)}</a>
<a id="12757" class="Comment">--                    → M ⤅ M′</a>
<a id="12788" class="Comment">--                    → CASE M N O ⤅ CASE M′ N O</a>
<a id="12837" class="Comment">-- congs-case done                = done</a>
<a id="12878" class="Comment">-- congs-case (step M↦M″ M″⤅M′) = step (cong-case M↦M″) (congs-case M″⤅M′)</a>


<a id="12955" class="Comment">-- -- If `M` reduces to `M′`, then `IF M N O` reduces to `IF M′ N O`.</a>
<a id="13025" class="Comment">-- congs-if : ∀ {g} → {M M′ N O : Term g}</a>
<a id="13067" class="Comment">--                  → M ⤅ M′</a>
<a id="13096" class="Comment">--                  → IF M N O ⤅ IF M′ N O</a>
<a id="13139" class="Comment">-- congs-if done                = done</a>
<a id="13178" class="Comment">-- congs-if (step M↦M″ M″⤅M′) = step (cong-if M↦M″) (congs-if M″⤅M′)</a>


<a id="13249" class="Comment">-- -- If `M` reduces to `PAIR M′ N′`, then `FST M` reduces to `M′`.</a>
<a id="13317" class="Comment">-- reds-fst-pair : ∀ {g} → {M M′ N′ : Term g} → {{_ : Val M′}} {{_ : Val N′}}</a>
<a id="13395" class="Comment">--                       → M ⤅ PAIR M′ N′</a>
<a id="13437" class="Comment">--                       → FST M ⤅ M′</a>
<a id="13475" class="Comment">-- reds-fst-pair M⤅PAIR = steps (congs-fst M⤅PAIR) (step (red fst-pair) done)</a>


<a id="13555" class="Comment">-- -- If `M` reduces to `PAIR M′ N′`, then `SND M` reduces to `N′`.</a>
<a id="13623" class="Comment">-- reds-snd-pair : ∀ {g} → {M M′ N′ : Term g} → {{_ : Val M′}} {{_ : Val N′}}</a>
<a id="13701" class="Comment">--                       → M ⤅ PAIR M′ N′</a>
<a id="13743" class="Comment">--                       → SND M ⤅ N′</a>
<a id="13781" class="Comment">-- reds-snd-pair M⤅PAIR = steps (congs-snd M⤅PAIR) (step (red snd-pair) done)</a>


<a id="13861" class="Comment">-- -- If `M` reduces to `TRUE` and `N` reduces to `N′`, then `IF M N O` reduces to `N′`.</a>
<a id="13950" class="Comment">-- reds-if-true : ∀ {g} → {M N N′ O : Term g}</a>
<a id="13996" class="Comment">--                      → M ⤅ TRUE → N ⤅ N′</a>
<a id="14040" class="Comment">--                      → IF M N O ⤅ N′</a>
<a id="14080" class="Comment">-- reds-if-true M⤅TRUE N⤅N′ = steps (congs-if M⤅TRUE) (step (red if-true) N⤅N′)</a>


<a id="14162" class="Comment">-- -- If `M` reduces to `FALSE` and `O` reduces to `O′`, then `IF M N O` reduces to `O′`.</a>
<a id="14252" class="Comment">-- reds-if-false : ∀ {g} → {M N O O′ : Term g}</a>
<a id="14299" class="Comment">--                       → M ⤅ FALSE → O ⤅ O′</a>
<a id="14345" class="Comment">--                       → IF M N O ⤅ O′</a>
<a id="14386" class="Comment">-- reds-if-false M⤅FALSE N⤅N′ = steps (congs-if M⤅FALSE) (step (red if-false) N⤅N′)</a>


<a id="14472" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="14558" class="Comment">-- -- `_⇓_` is the big-step reduction relation.</a>
<a id="14606" class="Comment">-- infix 3 _⇓_</a>
<a id="14621" class="Comment">-- _⇓_ : ∀ {g} → Term g → Term g → Set</a>
<a id="14660" class="Comment">-- M ⇓ M′ = M ⤅ M′ × Val M′</a>


<a id="14690" class="Comment">-- -- A big step can be extended with an initial small step.</a>
<a id="14751" class="Comment">-- -- Small-step reduction IN REVERSE preserves big-step reduction.</a>
<a id="14819" class="Comment">-- big-step : ∀ {g} → {M M′ M″ : Term g}</a>
<a id="14860" class="Comment">--                  → M ↦ M′ → M′ ⇓ M″</a>
<a id="14899" class="Comment">--                  → M ⇓ M″</a>
<a id="14928" class="Comment">-- big-step M↦M′ (M′⤅M″ , VM″) = step M↦M′ M′⤅M″ , VM″</a>


<a id="14985" class="Comment">-- -- The initial small step determines the subsequent big step.</a>
<a id="15050" class="Comment">-- -- Small-step reduction preserves big-step reduction.</a>
<a id="15107" class="Comment">-- big-unstep : ∀ {g} → {M M′ M″ : Term g}</a>
<a id="15150" class="Comment">--                    → M ↦ M′ → M ⇓ M″</a>
<a id="15190" class="Comment">--                    → M′ ⇓ M″</a>
<a id="15222" class="Comment">-- big-unstep M↦M′ (M′⤅M″ , VM″) = unstep {{VM″}} M↦M′ M′⤅M″ , VM″</a>


<a id="15291" class="Comment">-- -- Big-step reduction is deterministic.</a>
<a id="15334" class="Comment">-- det⇓ : ∀ {g} → {M M′₁ M′₂ : Term g}</a>
<a id="15373" class="Comment">--              → M ⇓ M′₁ → M ⇓ M′₂</a>
<a id="15409" class="Comment">--              → M′₁ ≡ M′₂</a>
<a id="15437" class="Comment">-- det⇓ (M⤅M′₁ , VM′₁) (M⤅M′₂ , VM′₂) = det⤅ {{VM′₁}} {{VM′₂}} M⤅M′₁ M⤅M′₂</a>


<a id="15514" class="Comment">-- -- If `M` reduces to `M′` and `N` reduces to `N′`, then `PAIR M N` reduces to `PAIR M′ N′`.</a>
<a id="15609" class="Comment">-- big-red-pair : ∀ {g} → {M M′ N N′ : Term g}</a>
<a id="15656" class="Comment">--                      → M ⇓ M′ → N ⇓ N′</a>
<a id="15698" class="Comment">--                      → PAIR M N ⇓ PAIR M′ N′</a>
<a id="15746" class="Comment">-- big-red-pair (M⤅M′ , VM′) (N⤅N′ , VN′) = congs-pair {{VM′}} {{VN′}} M⤅M′ N⤅N′ , val-pair {{VM′}} {{VN′}}</a>


<a id="15856" class="Comment">-- -- If `M` reduces to `PAIR M′ N′`, then `FST M` reduces to `M′`.</a>
<a id="15924" class="Comment">-- big-red-fst-pair : ∀ {g} → {M M′ N′ : Term g} → {{_ : Val M′}} {{_ : Val N′}}</a>
<a id="16005" class="Comment">--                          → M ⤅ PAIR M′ N′</a>
<a id="16050" class="Comment">--                          → FST M ⇓ M′</a>
<a id="16091" class="Comment">-- big-red-fst-pair {{VM′}} M⤅PAIR = reds-fst-pair M⤅PAIR , VM′</a>


<a id="16157" class="Comment">-- -- If `M` reduces to `PAIR M′ N′`, then `SND M` reduces to `N′`.</a>
<a id="16225" class="Comment">-- big-red-snd-pair : ∀ {g} → {M M′ N′ : Term g} → {{_ : Val M′}} {{_ : Val N′}}</a>
<a id="16306" class="Comment">--                          → M ⤅ PAIR M′ N′</a>
<a id="16351" class="Comment">--                          → SND M ⇓ N′</a>
<a id="16392" class="Comment">-- big-red-snd-pair {{_}} {{VN′}} M⤅PAIR = reds-snd-pair M⤅PAIR , VN′</a>


<a id="16464" class="Comment">-- -- If `M` reduces to `M′`, then `LEFT M` reduces to `LEFT M′`.</a>
<a id="16530" class="Comment">-- big-red-left : ∀ {g} → {M M′ : Term g}</a>
<a id="16572" class="Comment">--                      → M ⇓ M′</a>
<a id="16605" class="Comment">--                      → LEFT M ⇓ LEFT M′</a>
<a id="16648" class="Comment">-- big-red-left (M⤅M′ , VM′) = congs-left {{VM′}} M⤅M′ , val-left {{VM′}}</a>


<a id="16724" class="Comment">-- -- If `M` reduces to `M′`, then `RIGHT M` reduces to `RIGHT M′`.</a>
<a id="16792" class="Comment">-- big-red-right : ∀ {g} → {M M′ : Term g}</a>
<a id="16835" class="Comment">--                       → M ⇓ M′</a>
<a id="16869" class="Comment">--                       → RIGHT M ⇓ RIGHT M′</a>
<a id="16915" class="Comment">-- big-red-right (M⤅M′ , VM′) = congs-right {{VM′}} M⤅M′ , val-right {{VM′}}</a>


<a id="16994" class="Comment">-- -- If `M` reduces to `TRUE` and `N` reduces to `N′`, then `IF M N O` reduces to `N′`.</a>
<a id="17083" class="Comment">-- big-red-if-true : ∀ {g} → {M N N′ O : Term g}</a>
<a id="17132" class="Comment">--                         → M ⤅ TRUE → N ⇓ N′</a>
<a id="17179" class="Comment">--                         → IF M N O ⇓ N′</a>
<a id="17222" class="Comment">-- big-red-if-true M⤅TRUE (N⤅N′ , VN′) = reds-if-true M⤅TRUE N⤅N′ , VN′</a>


<a id="17296" class="Comment">-- -- If `M` reduces to `FALSE` and `O` reduces to `O′`, then `IF M N O` reduces to `O′`.</a>
<a id="17386" class="Comment">-- big-red-if-false : ∀ {g} → {M N O O′ : Term g}</a>
<a id="17436" class="Comment">--                          → M ⤅ FALSE → O ⇓ O′</a>
<a id="17485" class="Comment">--                          → IF M N O ⇓ O′</a>
<a id="17529" class="Comment">-- big-red-if-false M⤅FALSE (O⤅O′ , VO′) = reds-if-false M⤅FALSE O⤅O′ , VO′</a>


<a id="17607" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="17693" class="Comment">-- -- `_⇓` is the CBV termination relation.</a>
<a id="17737" class="Comment">-- _⇓ : ∀ {g} → Term g → Set</a>
<a id="17766" class="Comment">-- M ⇓ = Σ (Term _) (\ M′ → M ⇓ M′)</a>


<a id="17804" class="Comment">-- -- Small-step reduction IN REVERSE preserves termination.</a>
<a id="17865" class="Comment">-- -- Reversed small-step reduction is halt-preserving.</a>
<a id="17921" class="Comment">-- hpr↦ : ∀ {g} → {M M′ : Term g}</a>
<a id="17955" class="Comment">--               → M ↦ M′ → M′ ⇓</a>
<a id="17988" class="Comment">--               → M ⇓</a>
<a id="18011" class="Comment">-- hpr↦ M↦M′ (M″ , M′⇓M″) = M″ , big-step M↦M′ M′⇓M″</a>


<a id="18066" class="Comment">-- -- Small-step reduction preserves termination.</a>
<a id="18116" class="Comment">-- -- Small-step reduction is halt-preserving.</a>
<a id="18163" class="Comment">-- hp↦ : ∀ {g} → {M M′ : Term g}</a>
<a id="18196" class="Comment">--              → M ↦ M′ → M ⇓</a>
<a id="18227" class="Comment">--              → M′ ⇓</a>
<a id="18250" class="Comment">-- hp↦ M↦M′ (M″ , M′⇓M″) = M″ , big-unstep M↦M′ M′⇓M″</a>


<a id="18306" class="Comment">-- -- If `M` terminates and `N` terminates, then `PAIR M N` terminates.</a>
<a id="18378" class="Comment">-- halt-pair : ∀ {g} → {M N : Term g}</a>
<a id="18416" class="Comment">--                   → M ⇓ → N ⇓</a>
<a id="18449" class="Comment">--                   → PAIR M N ⇓</a>
<a id="18483" class="Comment">-- halt-pair (M′ , M⇓M′) (N′ , N⇓N′) = PAIR M′ N′ , big-red-pair M⇓M′ N⇓N′</a>


<a id="18560" class="Comment">-- -- If `M` reduces to `PAIR M′ N′`, then `FST M` terminates.</a>
<a id="18623" class="Comment">-- halt-fst-pair : ∀ {g} → {M M′ N′ : Term g} → {{_ : Val M′}} {{_ : Val N′}}</a>
<a id="18701" class="Comment">--                       → M ⤅ PAIR M′ N′</a>
<a id="18743" class="Comment">--                       → FST M ⇓</a>
<a id="18778" class="Comment">-- halt-fst-pair {M′ = M′} M⤅PAIR = M′ , big-red-fst-pair M⤅PAIR</a>


<a id="18845" class="Comment">-- -- If `M` reduces to `PAIR M′ N′`, then `SND M` terminates.</a>
<a id="18908" class="Comment">-- halt-snd-pair : ∀ {g} → {M M′ N′ : Term g} → {{_ : Val M′}} {{_ : Val N′}}</a>
<a id="18986" class="Comment">--                       → M ⤅ PAIR M′ N′</a>
<a id="19028" class="Comment">--                       → SND M ⇓</a>
<a id="19063" class="Comment">-- halt-snd-pair {N′ = N′} M⤅PAIR = N′ , big-red-snd-pair M⤅PAIR</a>


<a id="19130" class="Comment">-- -- If `M` terminates, then `FST M` terminates.</a>
<a id="19180" class="Comment">-- halt-fst : ∀ {g M A B} → {Γ : Types g}</a>
<a id="19222" class="Comment">--                        → Γ ⊢ M ⦂ A ∧ B → M ⇓</a>
<a id="19270" class="Comment">--                        → FST M ⇓</a>
<a id="19306" class="Comment">-- halt-fst 𝒟 (M′       , M⤅M′   , VM′)       with tp⤅ M⤅M′ 𝒟</a>
<a id="19368" class="Comment">-- halt-fst 𝒟 (LAM _    , _       , val-lam)   | ()</a>
<a id="19420" class="Comment">-- halt-fst 𝒟 (PAIR _ _ , M⤅PAIR , val-pair)  | pair _ _ = halt-fst-pair M⤅PAIR</a>
<a id="19500" class="Comment">-- halt-fst 𝒟 (UNIT     , _       , val-unit)  | ()</a>
<a id="19552" class="Comment">-- halt-fst 𝒟 (LEFT _   , _       , val-left)  | ()</a>
<a id="19604" class="Comment">-- halt-fst 𝒟 (RIGHT _  , _       , val-right) | ()</a>
<a id="19656" class="Comment">-- halt-fst 𝒟 (TRUE     , _       , val-true)  | ()</a>
<a id="19708" class="Comment">-- halt-fst 𝒟 (FALSE    , _       , val-false) | ()</a>


<a id="19762" class="Comment">-- -- If `M` terminates, then `SND M` terminates.</a>
<a id="19812" class="Comment">-- halt-snd : ∀ {g M A B} → {Γ : Types g}</a>
<a id="19854" class="Comment">--                        → Γ ⊢ M ⦂ A ∧ B → M ⇓</a>
<a id="19902" class="Comment">--                        → SND M ⇓</a>
<a id="19938" class="Comment">-- halt-snd 𝒟 (M′       , M⤅M′   , VM′)       with tp⤅ M⤅M′ 𝒟</a>
<a id="20000" class="Comment">-- halt-snd 𝒟 (LAM _    , _       , val-lam)   | ()</a>
<a id="20052" class="Comment">-- halt-snd 𝒟 (PAIR _ _ , M⤅PAIR , val-pair)  | pair _ _ = halt-snd-pair M⤅PAIR</a>
<a id="20132" class="Comment">-- halt-snd 𝒟 (UNIT     , _       , val-unit)  | ()</a>
<a id="20184" class="Comment">-- halt-snd 𝒟 (LEFT _   , _       , val-left)  | ()</a>
<a id="20236" class="Comment">-- halt-snd 𝒟 (RIGHT _  , _       , val-right) | ()</a>
<a id="20288" class="Comment">-- halt-snd 𝒟 (TRUE     , _       , val-true)  | ()</a>
<a id="20340" class="Comment">-- halt-snd 𝒟 (FALSE    , _       , val-false) | ()</a>


<a id="20394" class="Comment">-- -- If `M` terminates, then `ABORT M` terminates.</a>
<a id="20446" class="Comment">-- halt-abort : ∀ {g M} → {Γ : Types g}</a>
<a id="20486" class="Comment">--                      → Γ ⊢ M ⦂ 𝟘 → M ⇓</a>
<a id="20528" class="Comment">--                      → ABORT M ⇓</a>
<a id="20564" class="Comment">-- halt-abort 𝒟 (M′       , M⤅M′ , VM′)       with tp⤅ M⤅M′ 𝒟</a>
<a id="20626" class="Comment">-- halt-abort 𝒟 (LAM _    , _     , val-lam)   | ()</a>
<a id="20678" class="Comment">-- halt-abort 𝒟 (PAIR _ _ , _     , val-pair)  | ()</a>
<a id="20730" class="Comment">-- halt-abort 𝒟 (UNIT     , _     , val-unit)  | ()</a>
<a id="20782" class="Comment">-- halt-abort 𝒟 (LEFT _   , _     , val-left)  | ()</a>
<a id="20834" class="Comment">-- halt-abort 𝒟 (RIGHT _  , _     , val-right) | ()</a>
<a id="20886" class="Comment">-- halt-abort 𝒟 (TRUE     , _     , val-true)  | ()</a>
<a id="20938" class="Comment">-- halt-abort 𝒟 (FALSE    , _     , val-false) | ()</a>


<a id="20992" class="Comment">-- -- If `M` terminates, then `LEFT M` terminates.</a>
<a id="21043" class="Comment">-- halt-left : ∀ {g} → {M : Term g}</a>
<a id="21079" class="Comment">--                   → M ⇓</a>
<a id="21106" class="Comment">--                   → LEFT M ⇓</a>
<a id="21138" class="Comment">-- halt-left (M′ , M⇓M′) = LEFT M′ , big-red-left M⇓M′</a>


<a id="21195" class="Comment">-- -- If `M` terminates, then `RIGHT M` terminates.</a>
<a id="21247" class="Comment">-- halt-right : ∀ {g} → {M : Term g}</a>
<a id="21284" class="Comment">--                    → M ⇓</a>
<a id="21312" class="Comment">--                    → RIGHT M ⇓</a>
<a id="21346" class="Comment">-- halt-right (M′ , M⇓M′) = RIGHT M′ , big-red-right M⇓M′</a>


<a id="21406" class="Comment">-- -- If `M` reduces to `TRUE` and `N` terminates, then `IF M N O` terminates.</a>
<a id="21485" class="Comment">-- halt-if-true : ∀ {g} → {M N O : Term g}</a>
<a id="21528" class="Comment">--                      → M ⤅ TRUE → N ⇓</a>
<a id="21569" class="Comment">--                      → IF M N O ⇓</a>
<a id="21606" class="Comment">-- halt-if-true M⤅TRUE (N′ , N⇓N′) = N′ , big-red-if-true M⤅TRUE N⇓N′</a>


<a id="21678" class="Comment">-- -- If `M` reduces to `FALSE` and `O` terminates, then `IF M N O` terminates.</a>
<a id="21758" class="Comment">-- halt-if-false : ∀ {g} → {M N O : Term g}</a>
<a id="21802" class="Comment">--                       → M ⤅ FALSE → O ⇓</a>
<a id="21845" class="Comment">--                       → IF M N O ⇓</a>
<a id="21883" class="Comment">-- halt-if-false M⤅FALSE (O′ , O⇓O′) = O′ , big-red-if-false M⤅FALSE O⇓O′</a>


<a id="21959" class="Comment">-- -- If `M` terminates and `N` terminates and `O` terminates, then `IF M N O` terminates.</a>
<a id="22050" class="Comment">-- halt-if : ∀ {g M N O} → {Γ : Types g}</a>
<a id="22091" class="Comment">--                       → Γ ⊢ M ⦂ 𝔹 → M ⇓ → N ⇓ → O ⇓</a>
<a id="22146" class="Comment">--                       → IF M N O ⇓</a>
<a id="22184" class="Comment">-- halt-if 𝒟 (M′       , M⤅M′    , VM′)       N⇓ O⇓ with tp⤅ M⤅M′ 𝒟</a>
<a id="22252" class="Comment">-- halt-if 𝒟 (LAM _    , _        , val-lam)   N⇓ O⇓ | ()</a>
<a id="22310" class="Comment">-- halt-if 𝒟 (PAIR _ _ , _        , val-pair)  N⇓ O⇓ | ()</a>
<a id="22368" class="Comment">-- halt-if 𝒟 (UNIT     , _        , val-unit)  N⇓ O⇓ | ()</a>
<a id="22426" class="Comment">-- halt-if 𝒟 (LEFT _   , _        , val-left)  N⇓ O⇓ | ()</a>
<a id="22484" class="Comment">-- halt-if 𝒟 (RIGHT _  , _        , val-right) N⇓ O⇓ | ()</a>
<a id="22542" class="Comment">-- halt-if 𝒟 (TRUE     , M⤅TRUE  , val-true)  N⇓ O⇓ | true  = halt-if-true M⤅TRUE N⇓</a>
<a id="22627" class="Comment">-- halt-if 𝒟 (FALSE    , M⤅FALSE , val-false) N⇓ O⇓ | false = halt-if-false M⤅FALSE O⇓</a>


<a id="22716" class="Comment">-- -- Every well-typed term terminates.</a>
<a id="22756" class="Comment">-- -- Impossible without a stronger induction hypothesis.</a>
<a id="22814" class="Comment">-- {-</a>
<a id="22820" class="Comment">-- halt : ∀ {M A} → ∙ ⊢ M ⦂ A</a>
<a id="22850" class="Comment">--                → M ⇓</a>
<a id="22874" class="Comment">-- halt (var ())</a>
<a id="22891" class="Comment">-- halt (lam 𝒟)      = LAM _ , done , val-lam</a>
<a id="22937" class="Comment">-- halt (app 𝒟 ℰ)    = {!!}</a>
<a id="22965" class="Comment">-- halt (pair 𝒟 ℰ)   = halt-pair (halt 𝒟) (halt ℰ)</a>
<a id="23016" class="Comment">-- halt (fst 𝒟)      = halt-fst 𝒟 (halt 𝒟)</a>
<a id="23059" class="Comment">-- halt (snd 𝒟)      = halt-snd 𝒟 (halt 𝒟)</a>
<a id="23102" class="Comment">-- halt unit         = UNIT , done , val-unit</a>
<a id="23148" class="Comment">-- halt (abort 𝒟)    = halt-abort 𝒟 (halt 𝒟)</a>
<a id="23193" class="Comment">-- halt (left 𝒟)     = halt-left (halt 𝒟)</a>
<a id="23235" class="Comment">-- halt (right 𝒟)    = halt-right (halt 𝒟)</a>
<a id="23278" class="Comment">-- halt (case 𝒟 ℰ ℱ) = {!!}</a>
<a id="23306" class="Comment">-- halt true         = TRUE , done , val-true</a>
<a id="23352" class="Comment">-- halt false        = FALSE , done , val-false</a>
<a id="23400" class="Comment">-- halt (if 𝒟 ℰ ℱ)   = halt-if 𝒟 (halt 𝒟) (halt ℰ) (halt ℱ)</a>
<a id="23460" class="Comment">-- -}</a>


<a id="23468" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="23554" class="Comment">-- red-app-lam : ∀ {g n M N} → {τ : Terms g n} → {{_ : Val N}}</a>
<a id="23617" class="Comment">--                           → APP (LAM (SUB (LIFTS τ) M)) N ↦ SUB (τ , N) M</a>
<a id="23694" class="Comment">-- red-app-lam {M = M} {N} {τ} rewrite simp-CUT-SUB N τ M ⁻¹ = red app-lam</a>


<a id="23771" class="Comment">-- big-red-app-lam : ∀ {g n M M′ N} → {τ : Terms g n} → {{_ : Val N}}</a>
<a id="23841" class="Comment">--                                  → SUB (τ , N) M ⇓ M′</a>
<a id="23898" class="Comment">--                                  → APP (LAM (SUB (LIFTS τ) M)) N ⇓ M′</a>
<a id="23971" class="Comment">-- big-red-app-lam {M = M} (SUB⤅M′ , VM′) = step (red-app-lam {M = M}) SUB⤅M′ , VM′</a>


<a id="24057" class="Comment">-- halt-app-lam : ∀ {g n M N} → {τ : Terms g n} → {{_ : Val N}}</a>
<a id="24121" class="Comment">--                            → SUB (τ , N) M ⇓</a>
<a id="24169" class="Comment">--                            → APP (LAM (SUB (LIFTS τ) M)) N ⇓</a>
<a id="24233" class="Comment">-- halt-app-lam {M = M} (M′ , SUB⇓M′) = M′ , big-red-app-lam {M = M} SUB⇓M′</a>


<a id="24311" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="24397" class="Comment">-- red-case-left : ∀ {g n M N O} → {τ : Terms g n} → {{_ : Val M}}</a>
<a id="24464" class="Comment">--                               → CASE (LEFT M) (SUB (LIFTS τ) N) (SUB (LIFTS τ) O) ↦ SUB (τ , M) N</a>
<a id="24565" class="Comment">-- red-case-left {M = M} {N} {τ = τ} rewrite simp-CUT-SUB M τ N ⁻¹ = red case-left</a>


<a id="24650" class="Comment">-- big-red-case-left : ∀ {g n M N N′ O} → {τ : Terms g n} → {{_ : Val M}}</a>
<a id="24724" class="Comment">--                                      → SUB (τ , M) N ⇓ N′</a>
<a id="24785" class="Comment">--                                      → CASE (LEFT M) (SUB (LIFTS τ) N) (SUB (LIFTS τ) O) ⇓ N′</a>
<a id="24882" class="Comment">-- big-red-case-left {N = N} {O = O} (SUB⤅N′ , VN′) = step (red-case-left {N = N} {O}) SUB⤅N′ , VN′</a>


<a id="24984" class="Comment">-- halt-case-left : ∀ {g n M N O} → {τ : Terms g n} → {{_ : Val M}}</a>
<a id="25052" class="Comment">--                                → SUB (τ , M) N ⇓</a>
<a id="25104" class="Comment">--                                → CASE (LEFT M) (SUB (LIFTS τ) N) (SUB (LIFTS τ) O) ⇓</a>
<a id="25192" class="Comment">-- halt-case-left {N = N} {O} (N′ , SUB⇓N′) = N′ , big-red-case-left {N = N} {O = O} SUB⇓N′</a>


<a id="25286" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="25372" class="Comment">-- red-case-right : ∀ {g n M N O} → {τ : Terms g n} → {{_ : Val M}}</a>
<a id="25440" class="Comment">--                                → CASE (RIGHT M) (SUB (LIFTS τ) N) (SUB (LIFTS τ) O) ↦ SUB (τ , M) O</a>
<a id="25543" class="Comment">-- red-case-right {M = M} {O = O} {τ} rewrite simp-CUT-SUB M τ O ⁻¹ = red case-right</a>


<a id="25630" class="Comment">-- big-red-case-right : ∀ {g n M N O O′} → {τ : Terms g n} → {{_ : Val M}}</a>
<a id="25705" class="Comment">--                                       → SUB (τ , M) O ⇓ O′</a>
<a id="25767" class="Comment">--                                       → CASE (RIGHT M) (SUB (LIFTS τ) N) (SUB (LIFTS τ) O) ⇓ O′</a>
<a id="25866" class="Comment">-- big-red-case-right {N = N} {O} (SUB⤅O′ , VO′) = step (red-case-right {N = N} {O}) SUB⤅O′ , VO′</a>


<a id="25966" class="Comment">-- halt-case-right : ∀ {g n M N O} → {τ : Terms g n} → {{_ : Val M}}</a>
<a id="26035" class="Comment">--                                 → SUB (τ , M) O ⇓</a>
<a id="26088" class="Comment">--                                 → CASE (RIGHT M) (SUB (LIFTS τ) N) (SUB (LIFTS τ) O) ⇓</a>
<a id="26178" class="Comment">-- halt-case-right {N = N} {O} (O′ , SUB⇓O′) = O′ , big-red-case-right {N = N} {O} SUB⇓O′</a>


<a id="26270" class="Comment">-- --------------------------------------------------------------------------------</a>
</pre></body></html>